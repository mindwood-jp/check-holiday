日本の祝日を判定するBashスクリプト。

# 日本の祝日情報をどこから貰うか
内閣府ホームページで祝日情報CSVファイルを公開しているようなので、それを使うことにする。

```bash
curl -sL https://www8.cao.go.jp/chosei/shukujitsu/syukujitsu.csv | iconv -f cp932
```

URLの中に shukujitsu（ヘボン式）とsyukujitsu（訓令式）が混在しているが気にしないことにする。
将来URLが移転するかもしれないので、Lオプションでリダイレクトを有効にしておく。
iconvで指定する文字コードは sjis よりも cp932 の方が無難。

```
国民の祝日・休日月日,国民の祝日・休日名称
1955/1/1,元日
1955/1/15,成人の日
1955/3/21,春分の日
1955/4/29,天皇誕生日
     :
2020/7/24,スポーツの日
2020/8/10,山の日
2020/9/21,敬老の日
2020/9/22,秋分の日
2020/11/3,文化の日
2020/11/23,勤労感謝の日
```

日付の桁数も揃っていないが気にしないことにする。
（2020/1/1は2020/01/01にならないのかという意味）
1955年以降のすべての祝日・振替休日が登録されている。
ちなみに、このCSVファイルは、そのままExcelのWORKDAY関数に使える。

# Bash版
## check_holiday.sh
祝日情報を、内閣府のサーバに毎回問い合わせるのも忍びないので、ローカルにキャッシュする。キャッシュが古くなれば自動更新。

確実に祝日と言える場合のみ、終了ステータスに 0 がセットされる。

平日なのに祝日と誤判定することは無いが、祝日なのに平日と誤判定することは有り得る。

### cron定義例
業務開始前に実行させるジョブが、次のように定義されていたとすると、

```
00 7 * * * python3 /usr/local/bin/app.py
```

次のように追記するだけで、休日は実行しないようにできる。

```
00 7 * * * /usr/local/bin/check_holiday.sh || python3 /usr/local/bin/app.py
```

# PowerShell版
## check_holiday.ps1
`Invoke-WebRequest`がcurlに相当するコマンドレットだが、PowerShellの入出力はすべて .NET のクラスオブジェクトなので、画面で確認するなら次のようになる。

```powershell
(Invoke-WebRequest https://www8.cao.go.jp/chosei/shukujitsu/syukujitsu.csv).Content
```

Bash版同様、祝日ファイルをローカルにキャッシュし、古くなったら内閣府のサーバから取り直す。
確実に祝日と言える場合のみ、終了ステータスに 0 がセットされる点も同じ。

PowerShellでも`$?`で直前のコマンド終了ステータスを取得できるが、成功したか（0：True）失敗したか（0以外：False）のブール値で返るので注意。
失敗した理由まで知るには`$LastExitCode`を評価すると良い。

平日に必ず実行させるジョブがある場合、Falseかどうかだけ見れば良いことになる。
